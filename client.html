<!DOCTYPE html>
<html>
<head>
<title>Node.js Web Chat Demo</title>
<link rel="stylesheet" href="res/css/bootstrap.css">
</head>
  <body>
    <h1>Welcome on the chat</h1>
 
    <label for="msg-input">Broadcast message</label>
    <input id="msg-input" name="msg-input" type="text" size="30" />
    <p>Press enter to submit your message</p>
 
    <ul id="broadcast-msg"></ul>
 
    <!-- Include the socket.io javascript on the client side -->
    <script src="res/sockjs-0.3.2.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<style>
		span.dc { color: red; font-weight:bold; }
	</style>
 
    <script>
      // Establish the connection with the server
	  var sockjs_url = 'http://localhost:8000/sockjs';
	  var sock = new SockJS(sockjs_url);
 
	  // send JSON msg
	  function send(type, msg) {
	  	var toSend = {
			msg_type: type,
			content: msg 
		};
		sock.send(JSON.stringify(toSend));
	  }

      // on every message recived we print the new datas inside the #broadcast-msg div
	  sock.onmessage = function(message) {
	    var data = message.data;
        console.log('Get broadcasted msg:', data);
        var displayMessage = '<li>' + data + '</li>';
        $('#broadcast-msg').append(displayMessage);
      };
 
      // Create a new socket connection
      sock.onopen = function() {
 		var nickname = prompt('What is your nickname?');
		  send('set_nickname', nickname);
 
        $('#msg-input').change( function(){
          var txt = $(this).val();
          $(this).val('');
		  send('chat', txt);
        });
      };

	  // connection closed
	  sock.onclose = function() {alert('connection was closed');};
    </script>
  </body>
</html>
